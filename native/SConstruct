#!/usr/bin/env python
import os
from SCons.Script import *

# 1) Load the build environment from godot-cpp
#    (this sets up include paths, libs, platform/target, etc.)
env = SConscript("deps/godot-cpp/SConstruct")

# 2) Add your own headers folder
#    (relative to this SConstruct, i.e. native/voxel/include)
env.Append(CPPPATH=["voxel/include"])

# 3) Collect your C++ source files
#    (again relative to native/)
sources = Glob("voxel/src/*.cpp")

# 4) Where to place the built library:
#    ../addons/voxel/bin/voxel.(dll/so/dylib)
out_dir = os.path.join("..", "addons", "voxel", "bin")
if not os.path.exists(out_dir):
    os.makedirs(out_dir)

# SCons will append the correct extension automatically (.dll/.so/.dylib)
target_path = os.path.join(out_dir, "voxel")

library = env.SharedLibrary(target_path, source=sources)

Default(library)
